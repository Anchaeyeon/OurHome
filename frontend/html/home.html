<html>
<head>
    <title></title>
    <style>
        @font-face {
            font-family: 'Pretendard-Regular';
            src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            overflow: hidden;
        }

        .div {
            background: #ffffff;
            width: 393px;
            height: 850px;
            position: relative;
            overflow: hidden;
            transform: scale(0.8);
            transform-origin: top center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

       .line {
            width: 349px;
            height: 25px;
            position: absolute;
            left: calc(50% - 176.5px);
            top: 78px;
            overflow: visible;
        }

        .zoneAdd {
            width: 60px;
            height: 60px;
            position: absolute;
            left: 310px;
            top: 680px;
            overflow: visible;
        }

        .modal {
            display: none;
            /* 팝업 기본 감춤 */
            position: fixed;
            z-index: 1;
            left: -395;
            top: 10;
            width: 300%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 30%;
            max-width: 400px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }

        .close {
            float: right;
            width: 35px;
            /* 버튼 이미지 크기 */
            height: 35px;
            font-weight: bold;
            cursor: pointer;
        }

        /* 제목 스타일 */
        .modal-content h2 {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }

        /* 그룹 이름 입력란 스타일 */
        #zoneName {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background-color: #BFE4F9;
            /* 하늘색 배경 */
            border: 1px solid #ccc;
            border-radius: 10px;
            /* 둥근 모서리 */
            box-sizing: border-box;
        }

        /* 추가 버튼 스타일 */
        .add-button {
            display: block;
            width: 50%;
            padding: 12px;
            background-color: #1C98ED;
            color: white;
            font-size: 1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            margin: 15px auto 0;
            /* 중앙 정렬 */
            margin-top: 15px;
            box-sizing: border-box;
        }

        .returnBtn {
            width: 2.54%;
            height: 2.35%;
            position: absolute;
            right: 87.02%;
            left: 10.43%;
            bottom: 92.02%;
            top: 5.63%;
            transform: translate(-11.5px, -1.5px);
            overflow: visible;
        }

        .groupName {
            color: #000000;
            text-align: left;
            font-family: 'Pretendard-Regular';
            font-size: 24px;
            font-weight: 500;
            position: absolute;
            left: 164px;
            top: 44px;
        }

        /* 집안일 입력란 스타일 */
        #taskName {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background-color: #BFE4F9;
            /* 하늘색 배경 */
            border: 1px solid #ccc;
            border-radius: 10px;
            /* 둥근 모서리 */
            box-sizing: border-box;
        }

        .Nline {
            background: #ffffff;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.30);
            border-width: 1px;
            width: 403px;
            height: 81px;
            position: absolute;
            left: -5px;
            top: 773px;
        }

        .home {
            width: 47px;
            height: 47px;
            position: absolute;
            left: 50px;
            top: 789px;
            overflow: visible;
        }

        .stat {
            width: 8.9%;
            height: 4.07%;
            position: absolute;
            right: 15.2%;
            left: 75.9%;
            bottom: 2.62%;
            top: 93.31%;
            overflow: visible;
        }

        .request {
            width: 9.37%;
            height: 4.28%;
            position: absolute;
            right: 45.34%;
            left: 45.29%;
            bottom: 2.53%;
            top: 93.19%;
            overflow: visible;
        }


    /* 구역 리스트 컨테이너 */
#zonesContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start;
    margin-top: 100px;
    gap: 10px;
    padding: 10px;
    overflow-y: auto; /* 스크롤 추가 */
    height: 550px; /* 높이 조정 */
}


        #zonesContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            margin-top: 100px;
            gap: 10px;
            padding: 10px;
            overflow-y: auto; /* 스크롤 추가 */
        }

        /* 구역 컨테이너 스타일 */
        .zone-container {
            width: 180px;
            height: 250px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .zone-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        .task-button {
            width: 80%;
            padding: 10px;
            background-color: #1C98ED;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
        }
        
        /* 집안일 리스트 스타일 */

.task-list {
    list-style-type: none;
    padding: 0;
    margin-top: 10px;
   overflow-y: auto; /* 스크롤 추가 */
   max-height: 300px; /* 높이 조정 */
   max-width: 200px;
}
      /* 각 집안일란 스타일 */
.task-item {
    padding: 8px;
    margin: 10px 0;
    border-radius: 10px;
     background-color: #f0f0f0;
    font-size: 16px;
    width: 150px;
    color: #333;
}

</style>

        .task-list {
            list-style-type: none;
            padding: 0;
            margin-top: 10px;
            width: 100%;
            overflow-y: auto; /* 스크롤 추가 */
        }

        .task-item {
            padding: 8px;
            margin: 5px 0;
            background-color: #f0f0f0;
            border-radius: 10px;
            font-size: 16px;
            color: #333;
        }

        h2 {
            font-family: 'Pretendard-Regular';
        }

        p {
            font-family: 'Pretendard-Regular';
            font-size: 15px;
        }
    </style>

</head>
<body>
    <div class="div">
        <img src="img/return.png" class="returnBtn" onclick="goMain()">
        <div class="groupName"> 우리집 </div>
        <svg class="line" width="349" height="25" viewBox="0 0 349 25" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 12H351V13.5625H2V12Z" fill="black" fill-opacity="0.3" />
        </svg>
        
        <img src="img/plus.png" class="zoneAdd" onclick="openZoneModal()">
        
        <div id="zonesContainer"></div> <!--생성된 구역--->

 <!--하단바--->
        <div class="Nline"> </div>
   <div class="bottom-nav">
            <a href="home.html">
                <img src="img/home-nav.png" class="home">
            </a>
            <a href="request.html">
                <img src="img/request-nav.png" class="request">
            </a>
            <a href="stat.html">
                <img src="img/status-nav.png" class="stat">
            </a>
        </div>

    <!-- 집안일추가-->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <img src="img/xBtn.png" class="close" onclick="closeTask()" alt="닫기 버튼">
            <h2>집안일 추가</h2>
            <p>완료해야 할 집안일</p>
            <input type="text" id="taskName">
            <p>보상</p>
            <input type="number" id="taskReward" name="number_select" min="1" max="10" value="1">
            <button class="add-button" onclick="addTask()">추가</button>
        </div>
    </div>

    <!-- 구역추가-->
    <div id="ZoneModal" class="modal">
        <div class="modal-content">
            <img src="img/xBtn.png" class="close" onclick="closeZoneModal()" alt="닫기 버튼">
            <h2>구역 추가</h2>
            <p>집안일을 추가할 구역</p>
            <input type="text" placeholder="구역 이름" id="zoneName">
            <button class="add-button" onclick="addZone()">추가</button>
        </div>
    </div>

    <div id="checkTask" class="modal">
        <div class="modal-content">
            <img src="img/xBtn.png" class="close" onclick="closeCheckTask()" alt="닫기 버튼">
            <h2>인증 사진 첨부</h2>
            <input type="file" class="file-upload" accept="image/*" id="groupImageInput">
            <button class="add-button" onclick="completeTask()">완료</button>
        </div>
    </div>

</div>


    <script>
    let currentZoneId = null;

    function openZoneModal() {
        document.getElementById("ZoneModal").style.display = "block";
    }

    function closeZoneModal() {
        document.getElementById("ZoneModal").style.display = "none";
    }

    // 구역 추가 함수
    function addZone() {
        const zoneName = document.getElementById("zoneName").value.trim();

        if (zoneName === '') {
            alert("구역 이름을 입력해주세요.");
            return;
        }

        const zoneId = `zone-${Date.now()}`; // 고유한 구역 ID 생성

        const zoneDiv = document.createElement("div");
        zoneDiv.className = "zone-container";
        zoneDiv.id = zoneId;

        // 구역 이름 표시
        const zoneTitle = document.createElement("div");
        zoneTitle.className = "zone-title";
        zoneTitle.innerText = zoneName;

        // 집안일 리스트
        const taskList = document.createElement("ul");
        taskList.className = "task-list";
        taskList.id = `${zoneId}-tasks`;

        // 집안일 추가 버튼
        const taskButton = document.createElement("button");
        taskButton.className = "task-button";
        taskButton.innerText = "집안일 추가";
        taskButton.onclick = () => openTask(zoneId);

        // 구역 컨테이너에 요소 추가
        zoneDiv.appendChild(zoneTitle);
        zoneDiv.appendChild(taskList);
        zoneDiv.appendChild(taskButton);
        document.getElementById("zonesContainer").appendChild(zoneDiv);

        closeZoneModal();
        document.getElementById("zoneName").value = '';
    }

    // 집안일 추가 팝업창 열기
    function openTask(zoneId) {
        currentZoneId = zoneId; // 현재 구역 ID 저장
        document.getElementById("taskModal").style.display = "block";

    }

     // 집안일 추가 함수
        function addTask() {
            const taskName = document.getElementById("taskName").value.trim();
            const taskReward = document.getElementById("taskReward").value;

            if (taskName === '') {
                alert("집안일을 입력해주세요.");
                return;
            }

            if (taskReward === '' || taskReward <= 0) {
                alert("유효한 보상 값을 입력해주세요.");
                return;
            }

            const taskList = document.getElementById(`${currentZoneId}-tasks`);
            const taskItem = document.createElement("li");
            taskItem.className = "task-item";
            taskItem.innerText = taskName;
            taskItem.dataset.reward = taskReward; // 보상 값을 데이터 속성으로 저장

            // 보상 표시 기능 추가
            taskItem.onmouseover = () => {
                taskItem.title = `보상: ⭐ ${taskReward}개`;
            };

            taskItem.onclick = () => checkTask(taskItem);
            taskList.appendChild(taskItem);

            closeTask();
            document.getElementById("taskName").value = '';
            document.getElementById("taskReward").value = '1';

            taskItem.onclick = () => checkTask(taskItem);

        }

    // 집안일 추가 팝업창 닫기
    function closeTask() {
        document.getElementById("taskModal").style.display = "none";
    }

  // 집안일 완료 모달 열기
    function checkTask(taskItem) {
        currentTaskItem = taskItem; // 현재 선택된 집안일 요소 저장
        document.getElementById("checkTask").style.display = "block";
    }

   function completeTask() {
        const taskName = currentTaskItem.innerText;
        const taskReward = currentTaskItem.dataset.reward;
        const zoneId = currentZoneId;
        const zoneName = document.getElementById(zoneId).querySelector('.zone-title').innerText;
        const imageInput = document.getElementById("groupImageInput");

        if (imageInput.files.length > 0) {
            const imageFile = imageInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const imageData = e.target.result;

                const completedTasks = JSON.parse(localStorage.getItem("completedTasks")) || [];
                completedTasks.push({ zoneId, zoneName, taskName, imageData });
                localStorage.setItem("completedTasks", JSON.stringify(completedTasks));

                alert(`""${taskName}" 집안일이 완료되었습니다. 보상: ⭐ ${taskReward}개`);

                currentTaskItem.remove();
                closeCheckTask();
            };

            reader.readAsDataURL(imageFile);
        } else {
            alert("이미지를 첨부하세요");
        }
    }

     function closeCheckTask() {
            document.getElementById("checkTask").style.display = "none";
        }

    // 메인 화면으로 이동
    function goMain() {
        window.location.href = "Main.html";
    }

   // localStorage 사용량 확인 및 초기화
    function checkStorageUsage() {
        let usedBytes = 0;

        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                usedBytes += localStorage.getItem(key).length * 2; // 문자열의 길이 (UTF-16 기준)
            }
        }

        const usedKB = (usedBytes / 1024).toFixed(2); // 사용량 (KB)
        const maxStorageKB = 5120; // localStorage 최대 용량 (KB)
        const remainingKB = (maxStorageKB - usedKB).toFixed(2); // 남은 용량 (KB)

        console.log(`localStorage 사용량: ${usedKB} KB / ${maxStorageKB} KB`);
        console.log(`남은 용량: ${remainingKB} KB`);

        // 남은 용량이 500KB 이하이면 자동 초기화
        if (remainingKB <= 500) {
            localStorage.clear();
            console.log("localStorage가 초기화되었습니다.");
        }
    }


    </script>
</body>
</html>